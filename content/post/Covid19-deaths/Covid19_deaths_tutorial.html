---
title: "Covid19 deaths in the US by state"
author: Bonnie Thiel
date: 2021-09-15T21:13:14-05:00
slug: covid19deaths
categories: ["R"]
tags: ["R Markdown", "plot", "descriptive stats"]
---



<p><img src="/post/covidVirus.jpg" alt="covidVirus" />
START</p>
<div id="strategy" class="section level1">
<h1>Strategy:</h1>
<ul>
<li>Demonstrate how to get data from an internet source</li>
<li>do some data wrangling and simple statistical analysis</li>
<li>plot results</li>
</ul>
<p>Let’s calculate some statistics about deaths from Covid-19 based on CDC data:
<a href="https://data.cdc.gov/NCHS/Provisional-COVID-19-Deaths-by-Sex-and-Age/9bhg-hcku" class="uri">https://data.cdc.gov/NCHS/Provisional-COVID-19-Deaths-by-Sex-and-Age/9bhg-hcku</a></p>
<div id="step-1" class="section level2">
<h2>step 1:</h2>
<p>On the CDC page click on the EXPORT button on the top right of the page to download the csv file called ’Provisional_COVID-19_Death_Counts_by_Sex__Age.csv’
download it to your desktop or another folder and copy the path to the clipboard</p>
</div>
<div id="step-2" class="section level2">
<h2>step 2:</h2>
<p>Open R studio and click on File -&gt; New File -&gt; Rscript</p>
<p>You will need some packages so either use the “install.packages()” function, i.e. install.packages(c(“tidyverse”, “magrittr”))</p>
<p><strong>or</strong> the easier way is to go to the right-side window of Rstudio where it shows tabs for Files-Plots-Packages-Help-Viewer, and click on Packages.
Underneath there is a button for “Install”. Click install and type in the names of the packages: “magrittr” , “tidyverse”. These only have to be installed once until there is an update.</p>
</div>
<div id="step-3" class="section level2">
<h2>step 3:</h2>
<p>Load the libraries: this has to be done every time the script is run</p>
<p><strong>magrittr</strong> is for piping - explained later but just so you know the %&gt;% in R is called a pipe. You know the picture by Rene Magritte? of the pipe?
<strong>tidyverse</strong> contains many functions for data wrangling</p>
<pre class="r"><code>library(magrittr) 
library(tidyverse) </code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.4     v dplyr   1.0.2
## v tidyr   1.1.2     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x tidyr::extract()   masks magrittr::extract()
## x dplyr::filter()    masks stats::filter()
## x dplyr::lag()       masks stats::lag()
## x purrr::set_names() masks magrittr::set_names()</code></pre>
</div>
<div id="step-4" class="section level2">
<h2>step 4</h2>
<p>Load the dataset using the read.csv() or read.table() function</p>
<p><em>NOTE:</em> the path to your file needs forward slashes / for R not back slashes like windows uses
Copy the path from the clipboard in the read.table() function so that R knows where to find your data</p>
<p>read.csv() is the same function but assumes that the file is comma delimited
str() is a very important function that shows the structure of the data file
head() shows the first n rows of data</p>
<pre class="r"><code>covidDeaths &lt;- read.table(file=&quot;C:/Users/User/Documents/PersonalWebsite/bonniethiel/content/post/Covid19-deaths/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv&quot;, sep=&quot;,&quot;, header=TRUE) 
str(covidDeaths)</code></pre>
<pre><code>## &#39;data.frame&#39;:    66096 obs. of  16 variables:
##  $ Data.As.Of                              : chr  &quot;09/08/2021&quot; &quot;09/08/2021&quot; &quot;09/08/2021&quot; &quot;09/08/2021&quot; ...
##  $ Start.Date                              : chr  &quot;01/01/2020&quot; &quot;01/01/2020&quot; &quot;01/01/2020&quot; &quot;01/01/2020&quot; ...
##  $ End.Date                                : chr  &quot;09/04/2021&quot; &quot;09/04/2021&quot; &quot;09/04/2021&quot; &quot;09/04/2021&quot; ...
##  $ Group                                   : chr  &quot;By Total&quot; &quot;By Total&quot; &quot;By Total&quot; &quot;By Total&quot; ...
##  $ Year                                    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Month                                   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ State                                   : chr  &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; ...
##  $ Sex                                     : chr  &quot;All Sexes&quot; &quot;All Sexes&quot; &quot;All Sexes&quot; &quot;All Sexes&quot; ...
##  $ Age.Group                               : chr  &quot;All Ages&quot; &quot;Under 1 year&quot; &quot;0-17 years&quot; &quot;1-4 years&quot; ...
##  $ COVID.19.Deaths                         : int  643858 98 412 50 138 1232 3043 5395 8634 13567 ...
##  $ Total.Deaths                            : int  5507901 31347 55352 5798 9259 59389 104738 123138 150055 177545 ...
##  $ Pneumonia.Deaths                        : int  583698 336 924 187 270 1317 3071 5042 7728 11823 ...
##  $ Pneumonia.and.COVID.19.Deaths           : int  320617 12 93 10 40 496 1367 2551 4167 6714 ...
##  $ Influenza.Deaths                        : int  9272 22 188 65 80 80 148 236 324 366 ...
##  $ Pneumonia..Influenza..or.COVID.19.Deaths: int  914900 444 1431 292 448 2128 4883 8104 12494 19003 ...
##  $ Footnote                                : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...</code></pre>
<pre class="r"><code>head(covidDeaths, n=5)</code></pre>
<pre><code>##   Data.As.Of Start.Date   End.Date    Group Year Month         State       Sex
## 1 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States All Sexes
## 2 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States All Sexes
## 3 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States All Sexes
## 4 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States All Sexes
## 5 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States All Sexes
##      Age.Group COVID.19.Deaths Total.Deaths Pneumonia.Deaths
## 1     All Ages          643858      5507901           583698
## 2 Under 1 year              98        31347              336
## 3   0-17 years             412        55352              924
## 4    1-4 years              50         5798              187
## 5   5-14 years             138         9259              270
##   Pneumonia.and.COVID.19.Deaths Influenza.Deaths
## 1                        320617             9272
## 2                            12               22
## 3                            93              188
## 4                            10               65
## 5                            40               80
##   Pneumonia..Influenza..or.COVID.19.Deaths Footnote
## 1                                   914900         
## 2                                      444         
## 3                                     1431         
## 4                                      292         
## 5                                      448</code></pre>
</div>
<div id="step-5" class="section level2">
<h2>step 5</h2>
<p>Look at some of the variables to get a handle on what we’ve got:</p>
<pre class="r"><code>table(covidDeaths$Sex) </code></pre>
<pre><code>## 
## All Sexes    Female      Male 
##     22032     22032     22032</code></pre>
<pre class="r"><code>table(covidDeaths$Age.Group) </code></pre>
<pre><code>## 
##        0-17 years         1-4 years       15-24 years       18-29 years 
##              3888              3888              3888              3888 
##       25-34 years       30-39 years       35-44 years       40-49 years 
##              3888              3888              3888              3888 
##       45-54 years        5-14 years       50-64 years       55-64 years 
##              3888              3888              3888              3888 
##       65-74 years       75-84 years 85 years and over          All Ages 
##              3888              3888              3888              3888 
##      Under 1 year 
##              3888</code></pre>
<p>If you can see the table frequencies then everything seems to be working so let’s move on to data wrangling</p>
</div>
</div>
<div id="filter" class="section level1">
<h1>FILTER</h1>
<p>if you want to filter to a specific group to calculate the deaths, there are many, <em>many</em> ways in R. I think the best way is to use the functions from “tidyverse” along with “magrittr” which allows you to string together commands:</p>
<p>for example, to get only the numbers for males and females 18-29 years:</p>
<pre class="r"><code>covidDeaths.MF.18to29 &lt;- covidDeaths %&gt;% filter(Age.Group == &quot;18-29 years&quot; &amp; Sex %in% (c(&quot;Male&quot;, &quot;Female&quot;)))
head(covidDeaths.MF.18to29)</code></pre>
<pre><code>##   Data.As.Of Start.Date   End.Date    Group Year Month         State    Sex
## 1 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States   Male
## 2 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA United States Female
## 3 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA       Alabama   Male
## 4 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA       Alabama Female
## 5 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA        Alaska   Male
## 6 09/08/2021 01/01/2020 09/04/2021 By Total   NA    NA        Alaska Female
##     Age.Group COVID.19.Deaths Total.Deaths Pneumonia.Deaths
## 1 18-29 years            1886        76679             1885
## 2 18-29 years            1157        28059             1186
## 3 18-29 years              39         1484               31
## 4 18-29 years              22          545               24
## 5 18-29 years              NA          215               NA
## 6 18-29 years              NA           95               NA
##   Pneumonia.and.COVID.19.Deaths Influenza.Deaths
## 1                           828               78
## 2                           539               70
## 3                            14               NA
## 4                            NA                0
## 5                            NA               NA
## 6                            NA                0
##   Pneumonia..Influenza..or.COVID.19.Deaths
## 1                                     3012
## 2                                     1871
## 3                                       59
## 4                                       38
## 5                                       NA
## 6                                       NA
##                                                                                                                     Footnote
## 1                                                                                                                           
## 2                                                                                                                           
## 3 One or more data cells have counts between 1-9 and have been suppressed in accordance with NCHS confidentiality standards.
## 4 One or more data cells have counts between 1-9 and have been suppressed in accordance with NCHS confidentiality standards.
## 5 One or more data cells have counts between 1-9 and have been suppressed in accordance with NCHS confidentiality standards.
## 6 One or more data cells have counts between 1-9 and have been suppressed in accordance with NCHS confidentiality standards.</code></pre>
<p>The ‘&lt;-’ symbol is prounounced ‘gets’ and the %&gt;% is a pipe from the magrittr package and is called ‘and then’ so the syntax in words is:</p>
<p>#covidDeaths.MF.18to29 ‘gets’ covidDeaths object ‘and then’ filters to Age.group= 18-29 and Male or Female sex. <strong>Remember to use ‘==’ not just ‘=’</strong></p>
<p><img src="/post/Covid19-deaths/Covid19_deaths_tutorial_files/figure-html/pressure-1.png" width="672" /></p>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
</div>
